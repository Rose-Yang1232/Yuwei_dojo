#!/bin/sh

PATH="/run/dojo/bin:$PATH"
USER="hacker"

xfce_env() {
    local session_pid
    session_pid=$(pgrep -u "$USER" xfce4-session | head -n1)
    xargs -0 -a /proc/"$session_pid"/environ
}

xfce_run() {
    id
    which su
    echo "$USER"
    setsid runuser "$USER" -c "env - $(xfce_env) $*"
}

# Launch a background process that waits for xfce4-session and then runs the command.
(
    while ! pgrep -u "$USER" xfce4-session > /dev/null; do
        sleep 1
    done

    # Consider using --geometry to set the window size and position
    # Consider using --fullscreen to launch the application in fullscreen mode
    # xfce_run exo-open --launch TerminalEmulator

    xfce_run exo-open --launch TerminalEmulator &
    sleep 0.5  # Give it time to open

    # Get its window ID or title
    win1=$(wmctrl -l | grep Terminal | head -n 1 | awk '{print $1}')

    # Launch second terminal
    xfce_run exo-open --launch TerminalEmulator &
    sleep 0.5

    win2=$(wmctrl -l | grep Terminal | tail -n 1 | awk '{print $1}')

    # Get screen size (assumes 1920x1080)
    SCREEN_WIDTH=1920
    SCREEN_HEIGHT=1080
    HALF_WIDTH=$((SCREEN_WIDTH / 2))

    # Resize and move first terminal to left half
    wmctrl -i -r "$win1" -e 0,0,0,$HALF_WIDTH,$SCREEN_HEIGHT

    # Resize and move second terminal to right half
    wmctrl -i -r "$win2" -e 0,$HALF_WIDTH,0,$HALF_WIDTH,$SCREEN_HEIGHT
) &